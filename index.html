<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>CODM PRO Â· ××—×©×‘×•×Ÿ ×©×•×•×™ ×—×©×‘×•×Ÿ</title>
    <style>
        /* ===== RESET ××•×“×¨× ×™ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: #030507;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 12px;
        }

        /* ===== ×§×•× ×˜×™×™× ×¨ ×¨××©×™ â€“ ×’×™×™××™× ×’ ×¤×¨××™×•× ===== */
        .game-container {
            max-width: 500px;
            width: 100%;
            background: #0c0f14;
            border-radius: 48px;
            box-shadow: 0 25px 50px -8px rgba(0,255,255,0.25), 0 0 0 1px rgba(0,255,255,0.15) inset, 0 0 30px #00ffff15;
            padding: 24px 20px;
            position: relative;
            backdrop-filter: blur(2px);
        }

        /* ××¤×§×˜ led ×¢×“×™×Ÿ ××©×ª× ×” ×œ×¤×™ ×§×˜×’×•×¨×™×” (×™×•×—×œ×£ ×‘JS) */
        .game-container::after {
            content: "";
            position: absolute;
            top: -1px; left: -1px; right: -1px; bottom: -1px;
            border-radius: 49px;
            background: linear-gradient(135deg, #00ffff, #aa00ff, #00ffff);
            opacity: 0.2;
            z-index: -1;
            filter: blur(5px);
            transition: opacity 0.3s;
        }

        /* ===== ×¡×›×•× ×—×™ â€“ ×× ×™××¦×™×™×ª ×¡×˜×•×¤×¨ ×××™×ª×™×ª ===== */
        .balance-glass {
            background: rgba(0, 20, 20, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 60px;
            padding: 18px 24px;
            margin-bottom: 32px;
            box-shadow: 0 10px 30px -10px #00ffff40, 0 0 0 1px #00ffff20 inset;
        }

        .balance-label {
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 2px;
            color: #a0ecff;
            text-shadow: 0 0 8px cyan;
            margin-bottom: 6px;
        }

        .balance-value {
            font-size: 56px;
            font-weight: 800;
            color: #2effb0;
            text-shadow: 0 0 20px #00ff9d, 0 0 50px #00ff9d40;
            line-height: 1;
            direction: ltr;
            font-feature-settings: "tnum";
            display: flex;
            align-items: baseline;
            gap: 5px;
        }

        .balance-currency {
            font-size: 32px;
            color: #8effcf;
        }

        /* ===== ×›×¨×˜×™×¡×™×•×ª ×–×›×•×›×™×ª ===== */
        .step-card {
            background: rgba(16, 22, 30, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 40px;
            padding: 28px 22px;
            box-shadow: 0 20px 40px -20px black;
        }

        .question {
            font-size: 24px;
            font-weight: 600;
            color: white;
            text-shadow: 0 0 10px cyan;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(0,255,255,0.1);
            border: 1px solid cyan;
            color: cyan;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: 0.2s;
        }
        .info-icon:hover {
            background: cyan;
            color: black;
            box-shadow: 0 0 30px cyan;
        }

        /* ===== ×›×¤×ª×•×¨×™ ×‘×—×™×¨×” (×’×“×•×œ×™×) ===== */
        .choice-grid {
            display: flex;
            gap: 15px;
            margin: 20px 0 15px;
        }
        .choice-btn {
            flex: 1;
            background: #1a1e26;
            border: 2px solid #2a3a4a;
            border-radius: 50px;
            padding: 22px 0;
            font-size: 26px;
            font-weight: 700;
            color: #bfd9ff;
            cursor: pointer;
            transition: 0.15s;
            box-shadow: 0 8px 0 #0b0e12;
            text-align: center;
        }
        .choice-btn.active {
            border-color: #0ff;
            background: #0b1a1f;
            color: #0ff;
            box-shadow: 0 0 30px cyan, 0 6px 0 #008b8b;
            transform: translateY(-2px);
        }

        /* ===== ×¡×œ×™×™×“×¨ ×—×œ×§ ×‘×¨××” ×©×œ ××¤×œ×™×§×¦×™×™×ª ××©×—×§ ===== */
        .slider-super-container {
            margin: 35px 0 10px;
        }
        .value-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .number-box {
            background: #10161e;
            border: 2px solid #00ffff40;
            border-radius: 30px;
            padding: 8px 25px;
            width: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .number-box input {
            background: transparent;
            border: none;
            color: #0ff;
            font-size: 42px;
            font-weight: 700;
            width: 100%;
            text-align: center;
            outline: none;
            direction: ltr;
            padding: 5px 0;
        }
        /* ××§×œ×“×ª ××¡×¤×¨×™× ×‘×œ×‘×“ */
        input[type="number"] {
            -moz-appearance: textfield;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* ×¡×œ×™×™×“×¨ ××•×“×¨× ×™ - ×—×œ×§ ×œ××’×¢ */
        .slider-pro {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #005f5f, #00ffff);
            border-radius: 20px;
            outline: none;
            touch-action: none;  /* ×œ×× ×•×¢ ×’×œ×™×œ×ª ×“×£ ×‘×–××Ÿ ×’×¨×™×¨×” */
        }
        .slider-pro::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 32px;
            height: 32px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 30px cyan, 0 0 10px cyan;
            border: 3px solid #0ff;
            cursor: pointer;
            margin-top: -12px;
            transition: 0.1s;
        }
        .slider-pro::-webkit-slider-thumb:active {
            transform: scale(1.2);
        }
        .limit-row {
            display: flex;
            justify-content: space-between;
            color: #80d0ff;
            margin: 12px 0 8px;
            font-size: 16px;
        }
        .progress-glow {
            width: 100%;
            height: 8px;
            background: #1e2632;
            border-radius: 20px;
            overflow: hidden;
            margin: 15px 0 5px;
            box-shadow: 0 0 10px #00ffff20 inset;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0ff, #f0f);
            width: 0%;
            border-radius: 20px;
            box-shadow: 0 0 20px #0ff;
        }

        /* ×¦×‘×¢×™ ×§×˜×’×•×¨×™×” â€“ ×™×©×ª× ×• ×‘×œ×™×• */
        .mythic-glow .progress-fill { background: linear-gradient(90deg, #ff4444, #ff8888); }
        .legendary-glow .progress-fill { background: linear-gradient(90deg, #ffaa33, #ffdd44); }
        .epic-glow .progress-fill { background: linear-gradient(90deg, #b266ff, #d9aaff); }

        /* ===== ×“×™×¨×•×’ ×¢×•× ×ª×™ ===== */
        .rank-panel {
            background: #0f141cb3;
            border-radius: 40px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid cyan;
        }
        .rank-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
        .rank-tab {
            flex: 1;
            background: #161e2a;
            border: 1px solid #0ff;
            border-radius: 40px;
            padding: 14px 0;
            color: #0ff;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
        }
        .rank-tab.active {
            background: #0ff;
            color: black;
            box-shadow: 0 0 30px cyan;
        }

        /* ===== ×›×¤×ª×•×¨×™ × ×™×•×•×˜ ===== */
        .nav-row {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }
        .nav-btn {
            flex: 1;
            background: transparent;
            border: 2px solid cyan;
            color: cyan;
            font-size: 22px;
            font-weight: 700;
            padding: 18px 0;
            border-radius: 60px;
            cursor: pointer;
            transition: 0.15s;
            box-shadow: 0 0 20px cyan;
            text-align: center;
        }
        .nav-btn:disabled {
            opacity: 0.3;
            filter: grayscale(1);
            pointer-events: none;
        }
        .nav-btn:hover {
            background: cyan;
            color: black;
        }

        /* ===== ××•×“×œ ××™×“×¢ ===== */
        .modal {
            display: none;
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-card {
            background: #111a24;
            border: 2px solid cyan;
            border-radius: 60px;
            padding: 35px 30px;
            max-width: 380px;
            width: 90%;
            box-shadow: 0 0 100px cyan;
            color: white;
            position: relative;
        }
        .close-modal {
            position: absolute;
            left: 25px; top: 20px;
            font-size: 35px;
            cursor: pointer;
            color: cyan;
        }

        /* ×¡×™×›×•× */
        .summary-block {
            background: #0f1620;
            border-radius: 50px;
            padding: 30px;
            text-align: center;
        }
        .strike-price {
            font-size: 32px;
            color: #c0c0ff;
            text-decoration: line-through #ff8888 4px;
            margin-bottom: 15px;
        }
        .final-price {
            font-size: 72px;
            font-weight: 900;
            color: #ff4d4d;
            text-shadow: 0 0 50px red;
            line-height: 1;
        }
        .price-label {
            color: cyan;
            font-size: 18px;
            margin-top: 10px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
<div class="game-container" id="gameContainer">

    <!-- ××•×“×œ ××™×“×¢ -->
    <div id="modal" class="modal" onclick="if(event.target===this) closeModal()">
        <div class="modal-card">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modalMessage" style="font-size:20px; line-height:1.6;"></div>
        </div>
    </div>

    <!-- ××¡×š ×¤×ª×™×— -->
    <div id="welcomeScreen">
        <div style="text-align:center; padding: 40px 0;">
            <div style="font-size: 48px; font-weight: 800; color:#0ff; text-shadow:0 0 50px cyan; margin-bottom:20px;">CODM VALUE</div>
            <div style="color:#b0e0ff; font-size:18px; margin:30px 0;">××—×©×‘×•×Ÿ ×©×•×•×™ ×—×©×‘×•× ×•×ª ××§×¦×•×¢×™</div>
            <button class="nav-btn" style="width:100%; background:cyan; color:black; border:none; padding:25px; font-size:36px;" onclick="startApp()">ğŸš€ ×”×ª×—×œ</button>
            <div style="margin-top:50px; color:#00ffff60;">Powered by LED</div>
        </div>
    </div>

    <!-- ××¡×š ××—×©×‘×•×Ÿ ×¨××©×™ -->
    <div id="calcScreen" class="hidden">
        <!-- ×¡×›×•× ×—×™ -->
        <div class="balance-glass">
            <div class="balance-label">×©×•×•×™ × ×•×›×—×™</div>
            <div class="balance-value" id="balanceDisplay">0<span style="font-size:32px;">.00</span> <span class="balance-currency">â‚ª</span></div>
        </div>

        <!-- ×¢×¥ ×©×œ×‘×™× ×™×•×—×œ×£ ×“×™× ××™×ª -->
        <div id="stepContainer" class="step-card"></div>

        <!-- × ×™×•×•×˜ -->
        <div class="nav-row">
            <button class="nav-btn" id="prevStepBtn" onclick="prevStep()" disabled>×”×§×•×“×</button>
            <button class="nav-btn" id="nextStepBtn" onclick="nextStep()">×”×‘×</button>
        </div>
    </div>
</div>

<script>
    (function() {
        // -------------------- ×§×•× ×¤×™×’×•×¨×¦×™×” ××¨×›×–×™×ª --------------------
        const PRICES = {
            discounted: {   // ×—×©×‘×•×Ÿ ××•×–×œ
                year: 40,
                weaponMythic: 210,
                weaponLegendary: 160,
                weaponEpic: 1,
                weaponMythicMax: 89,
                characterMythic: 250,
                characterMythicMax: 110,
                characterLegendary: 170,
                characterEpic: 1,
                characterRare: 80,
                level: 0.5,
                rank: 1
            },
            regular: {      // ×—×©×‘×•×Ÿ ×œ× ××•×–×œ
                year: 40,
                weaponMythic: 420,
                weaponLegendary: 350,
                weaponEpic: 2,
                weaponMythicMax: 380,
                characterMythic: 450,
                characterMythicMax: 350,
                characterLegendary: 400,
                characterEpic: 1,
                characterRare: 120,
                level: 0.5,
                rank: 1
            }
        };

        const LIMITS = {
            years: 9,
            mythicWeapons: 32,
            mythicWeaponsMax: 32,
            legWeapons: 255,
            epicWeapons: 991,
            mythicChars: 7,
            mythicCharsMax: 7,
            legChars: 28,
            epicChars: 1000,
            rareChars: 100,
            level: 400,
            rankMax: 16  // 0-16 = 17 ×¨××•×ª
        };

        // ××¦×‘ ××¤×œ×™×§×¦×™×”
        let state = {
            discounted: true,           // true = ××•×–×œ
            years: 0,
            mythicWeapons: 0,
            mythicWeaponsMax: 0,
            legWeapons: 0,
            epicWeapons: 0,
            mythicChars: 0,
            mythicCharsMax: 0,
            legChars: 0,
            epicChars: 0,
            rareCharExist: false,
            rareCharAmount: 0,
            level: 0,
            rankMP: 0,
            rankBR: 0,
            rankDMZ: 0
        };

        const stepList = [
            'accountType', 'years', 'mythicWeapons', 'mythicWeaponsMax', 'legWeapons', 'epicWeapons',
            'mythicChars', 'mythicCharsMax', 'legChars', 'epicChars', 'rareCharExist', 'rareCharAmount',
            'level', 'ranks', 'summary'
        ];
        let currentStep = 0;

        // ×× ×™××¦×™×™×ª ×¡×˜×•×¤×¨ ×××™×ª×™×ª
        let animFrame = null;
        let targetBalance = 0;
        let displayedBalance = 0;

        // ------------------------------------------------------------------
        // ×—×™×©×•×‘ ×©×•×•×™ ×›×•×œ×œ ×œ×¤×™ state
        function computeTotal() {
            const p = state.discounted ? PRICES.discounted : PRICES.regular;
            let total = 0;
            total += state.years * p.year;
            total += state.mythicWeapons * p.weaponMythic;
            total += state.legWeapons * p.weaponLegendary;
            total += state.epicWeapons * p.weaponEpic;
            total += state.mythicWeaponsMax * p.weaponMythicMax;
            total += state.mythicChars * p.characterMythic;
            total += state.mythicCharsMax * p.characterMythicMax;
            total += state.legChars * p.characterLegendary;
            total += state.epicChars * p.characterEpic;
            total += (state.rareCharExist ? state.rareCharAmount : 0) * p.characterRare;
            total += state.level * p.level;
            total += (state.rankMP + state.rankBR + state.rankDMZ) * p.rank;
            return total;
        }

        // ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×¡×›×•× ×‘×× ×™××¦×™×™×ª ×¡×˜×•×¤×¨ ×—×œ×§×”
        function updateBalanceVisual() {
            targetBalance = computeTotal();
            if (animFrame) cancelAnimationFrame(animFrame);
            const stepTime = 8; // ××”×™×¨×•×ª ×¢×“×›×•×Ÿ (ms)
            const direction = targetBalance > displayedBalance ? 1 : -1;
            const diff = Math.abs(targetBalance - displayedBalance);
            if (diff < 0.01) {
                displayedBalance = targetBalance;
                renderBalance();
                return;
            }
            const increment = Math.max(0.5, diff / 15); // ×”××¦×”/×”××˜×” ×˜×‘×¢×™×ª
            function animate() {
                if (Math.abs(targetBalance - displayedBalance) < 0.5) {
                    displayedBalance = targetBalance;
                    renderBalance();
                    return;
                }
                displayedBalance += direction * increment;
                if ((direction === 1 && displayedBalance > targetBalance) || (direction === -1 && displayedBalance < targetBalance)) {
                    displayedBalance = targetBalance;
                }
                renderBalance();
                animFrame = requestAnimationFrame(animate);
            }
            animFrame = requestAnimationFrame(animate);
        }

        function renderBalance() {
            const el = document.getElementById('balanceDisplay');
            if (!el) return;
            const parts = displayedBalance.toFixed(2).split('.');
            el.innerHTML = `${parts[0]}<span style="font-size:32px;">.${parts[1]}</span> <span class="balance-currency">â‚ª</span>`;
        }

        // ×©××™×¨×” ×‘-LocalStorage
        function persistState() {
            localStorage.setItem('codmState', JSON.stringify({ state, currentStep }));
        }

        // ×˜×¢×™× ×” ×× ×§×™×™×
        function loadPersisted() {
            const saved = localStorage.getItem('codmState');
            if (saved) {
                try {
                    const { state: s, currentStep: c } = JSON.parse(saved);
                    if (s) state = s;
                    if (c !== undefined) currentStep = c;
                    return true;
                } catch (e) {}
            }
            return false;
        }

        // UI ×©×œ ×”×©×œ×‘ ×”× ×•×›×—×™
        function renderStep() {
            const container = document.getElementById('stepContainer');
            if (!container) return;

            const step = stepList[currentStep];
            let html = '';

            if (step === 'accountType') {
                html = `
                    <div class="question">×¡×•×’ ×—×©×‘×•×Ÿ <span class="info-icon" onclick="showInfo('×—×©×‘×•×Ÿ ××•×–×œ × ×¤×ª×— ×“×¨×š VPN ×”×•×“×•. ××—×™×¨×™ CP × ××•×›×™× ×™×•×ª×¨.')">?</span></div>
                    <div class="choice-grid">
                        <button class="choice-btn ${state.discounted ? 'active' : ''}" onclick="setAccountType(true)">××•×–×œ</button>
                        <button class="choice-btn ${!state.discounted ? 'active' : ''}" onclick="setAccountType(false)">×¨×’×™×œ</button>
                    </div>
                    <div style="margin-top:20px; color:#0ff; cursor:pointer;" onclick="showInfo('×‘×—×©×‘×•×Ÿ ××•×–×œ ×¤×ª×™×—×•×ª ×”×’×¨×œ×•×ª ×-10CP, ×‘×¨×’×™×œ ×-30CP')">ğŸ“Œ ××™×š ×™×•×“×¢×™×?</div>
                `;
            } else if (step === 'years') {
                html = renderSlider('×•×•×ª×§ (×©× ×™×)', 'years', state.years, 0, LIMITS.years, '×©× ×™×');
            } else if (step === 'mythicWeapons') {
                html = renderSlider('× ×©×§×™ ××™×˜×™×§', 'mythicWeapons', state.mythicWeapons, 0, LIMITS.mythicWeapons, '×™×—', 'mythic');
            } else if (step === 'mythicWeaponsMax') {
                if (state.mythicWeapons > 0)
                    html = renderSlider('××ª×•×›× MAX', 'mythicWeaponsMax', state.mythicWeaponsMax, 0, Math.min(state.mythicWeapons, LIMITS.mythicWeaponsMax), 'MAX', 'mythic');
                else { currentStep++; renderStep(); return; }
            } else if (step === 'legWeapons') {
                html = renderSlider('× ×©×§×™ ×œ×’×³× ×“×¨×™', 'legWeapons', state.legWeapons, 0, LIMITS.legWeapons, '×™×—', 'legendary');
            } else if (step === 'epicWeapons') {
                html = renderSlider('× ×©×§×™ ××¤×™×§', 'epicWeapons', state.epicWeapons, 0, LIMITS.epicWeapons, '×™×—', 'epic');
            } else if (step === 'mythicChars') {
                html = renderSlider('×“××•×™×•×ª ××™×˜×™×§', 'mythicChars', state.mythicChars, 0, LIMITS.mythicChars, '×“××•×™×•×ª', 'mythic');
            } else if (step === 'mythicCharsMax') {
                if (state.mythicChars > 0)
                    html = renderSlider('××ª×•×›×Ÿ MAX', 'mythicCharsMax', state.mythicCharsMax, 0, Math.min(state.mythicChars, LIMITS.mythicCharsMax), 'MAX', 'mythic');
                else { currentStep++; renderStep(); return; }
            } else if (step === 'legChars') {
                html = renderSlider('×“××•×™×•×ª ×œ×’×³× ×“×¨×™', 'legChars', state.legChars, 0, LIMITS.legChars, '×“××•×™×•×ª', 'legendary');
            } else if (step === 'epicChars') {
                html = renderSlider('×“××•×™×•×ª ××¤×™×§', 'epicChars', state.epicChars, 0, LIMITS.epicChars, '×“××•×™×•×ª', 'epic');
            } else if (step === 'rareCharExist') {
                html = `
                    <div class="question">×“××•×™×•×ª ××’×“×™×•×ª × ×“×™×¨×•×ª?</div>
                    <div class="choice-grid">
                        <button class="choice-btn ${state.rareCharExist ? 'active' : ''}" onclick="setRareExist(true)">×›×Ÿ</button>
                        <button class="choice-btn ${!state.rareCharExist ? 'active' : ''}" onclick="setRareExist(false)">×œ×</button>
                    </div>
                `;
            } else if (step === 'rareCharAmount') {
                if (state.rareCharExist)
                    html = renderSlider('×›××•×ª × ×“×™×¨×•×ª', 'rareCharAmount', state.rareCharAmount, 0, LIMITS.rareChars, '×“××•×™×•×ª', 'legendary');
                else { currentStep++; renderStep(); return; }
            } else if (step === 'level') {
                html = renderSlider('×¨××ª ×—×©×‘×•×Ÿ', 'level', state.level, 0, LIMITS.level, '×¨××”');
            } else if (step === 'ranks') {
                html = renderRanks();
            } else if (step === 'summary') {
                const total = computeTotal();
                const sellMultiplier = state.discounted ? 0.35 : 0.55; // 65% off / 45% off
                const sellPrice = total * sellMultiplier;
                html = `
                    <div class="summary-block">
                        <div style="font-size:26px; color:cyan;">×¡×™×›×•× ×”×©×§×¢×”</div>
                        <div class="strike-price">${total.toFixed(2)} â‚ª</div>
                        <div style="font-size:22px; margin:10px 0;">××—×™×¨ ××›×™×¨×” ××•××œ×¥</div>
                        <div class="final-price">${sellPrice.toFixed(2)} â‚ª</div>
                        <div class="price-label">${state.discounted ? '65% ×”× ×—×”' : '45% ×”× ×—×”'} ×××—×™×¨ ×”×”×©×§×¢×”</div>
                        <button class="nav-btn" style="margin-top:30px;" onclick="resetToWelcome()">×—×™×©×•×‘ ×—×“×©</button>
                    </div>
                `;
            }

            container.innerHTML = html;
            attachEvents(step);
            document.getElementById('prevStepBtn').disabled = (currentStep === 0);
            if (step === 'summary') document.getElementById('nextStepBtn').style.display = 'none';
            else document.getElementById('nextStepBtn').style.display = 'block';

            updateBalanceVisual();
        }

        function renderSlider(label, key, val, min, max, unit, theme = '') {
            const fill = (val / max) * 100;
            const themeClass = theme === 'mythic' ? 'mythic-glow' : (theme === 'legendary' ? 'legendary-glow' : (theme === 'epic' ? 'epic-glow' : ''));
            return `
                <div class="question">${label} <span class="info-icon" onclick="showInfo('${getTooltip(key)}')">?</span></div>
                <div class="slider-super-container ${themeClass}">
                    <div class="value-row">
                        <div class="number-box">
                            <input type="number" id="${key}Input" value="${val}" min="${min}" max="${max}" step="1" inputmode="numeric" oninput="handleNumberInput('${key}', this.value)">
                        </div>
                        <span style="color:#0ff; font-size:24px;">${unit}</span>
                    </div>
                    <input class="slider-pro" type="range" id="${key}Slider" min="${min}" max="${max}" value="${val}" step="1" oninput="handleSlider('${key}', this.value)" ontouchstart="" style="touch-action: none;">
                    <div class="limit-row">
                        <span>${val} / ${max}</span>
                        <span>${unit}</span>
                    </div>
                    <div class="progress-glow"><div class="progress-fill" style="width:${fill}%;"></div></div>
                </div>
            `;
        }

        function renderRanks() {
            return `
                <div class="question">×“×™×¨×•×’ ×¢×•× ×ª×™ <span class="info-icon" onclick="showInfo('MP, BR, DMZ â€“ ×›×œ ×¨××” = 1â‚ª')">?</span></div>
                <div class="rank-panel">
                    <div class="rank-tabs" id="rankTabs">
                        <button class="rank-tab active" onclick="showRank('mp')">MP</button>
                        <button class="rank-tab" onclick="showRank('br')">BR</button>
                        <button class="rank-tab" onclick="showRank('dmz')">DMZ</button>
                    </div>
                    <div id="rankMPPanel">${rankSlider('MP', state.rankMP)}</div>
                    <div id="rankBRPanel" class="hidden">${rankSlider('BR', state.rankBR)}</div>
                    <div id="rankDMZPanel" class="hidden">${rankSlider('DMZ', state.rankDMZ)}</div>
                </div>
            `;
        }

        function rankSlider(name, val) {
            return `
                <div style="display:flex; justify-content:space-between; color:cyan;">${name} <span>${rankToText(val)}</span></div>
                <input class="slider-pro" type="range" min="0" max="16" value="${val}" step="1" oninput="updateRank('${name.toLowerCase()}', this.value)" style="margin:15px 0;">
                <div class="progress-glow"><div class="progress-fill" style="width:${(val/16)*100}%;"></div></div>
            `;
        }

        function rankToText(r) {
            if (r <= 4) return 'PRO ' + ['I','II','III','IV','V'][r];
            if (r <= 9) return 'MASTER ' + ['I','II','III','IV','V'][r-5];
            if (r <= 14) return 'GRAND MASTER ' + ['I','II','III','IV','V'][r-10];
            return 'LEGENDARY';
        }

        function getTooltip(key) {
            const tips = {
                years: '×•×•×ª×§ ×‘×—×©×‘×•×Ÿ (×©× ×™×)',
                mythicWeapons: '× ×©×§×™× ××™×ª×™×™× â€“ ××“×•×',
                mythicWeaponsMax: '× ×©×§ ××™×˜×™×§ ×©×“×¨×•×’ ××§×¡×™××•×',
                legWeapons: '× ×©×§×™× ×œ×’×³× ×“×¨×™×™×',
                epicWeapons: '× ×©×§×™× ××¤×™×™×',
                mythicChars: '×“××•×™×•×ª ××™×˜×™×§',
                legChars: '×“××•×™×•×ª ×œ×’×³× ×“×¨×™',
                epicChars: '×“××•×™×•×ª ××¤×™×§',
                rareCharAmount: '×“××•×™×•×ª ××’×“×™×•×ª × ×“×™×¨×•×ª',
                level: '×¨××ª ×”×—×©×‘×•×Ÿ (×¢×“ 400)'
            };
            return tips[key] || '××™×“×¢';
        }

        // event handlers
        window.handleSlider = function(key, val) {
            state[key] = parseInt(val, 10);
            if (key === 'mythicWeapons' && state.mythicWeaponsMax > state.mythicWeapons) state.mythicWeaponsMax = state.mythicWeapons;
            if (key === 'mythicChars' && state.mythicCharsMax > state.mythicChars) state.mythicCharsMax = state.mythicChars;
            persistState();
            renderStep();
        };
        window.handleNumberInput = function(key, val) {
            let v = parseInt(val, 10);
            if (isNaN(v)) v = 0;
            const max = LIMITS[key] || 9999;
            v = Math.min(v, max);
            state[key] = v;
            if (key === 'mythicWeapons' && state.mythicWeaponsMax > state.mythicWeapons) state.mythicWeaponsMax = state.mythicWeapons;
            if (key === 'mythicChars' && state.mythicCharsMax > state.mythicChars) state.mythicCharsMax = state.mythicChars;
            persistState();
            renderStep();
        };
        window.setAccountType = function(disc) { state.discounted = disc; persistState(); renderStep(); };
        window.setRareExist = function(val) { state.rareCharExist = val; if (!val) state.rareCharAmount = 0; persistState(); renderStep(); };
        window.updateRank = function(type, val) {
            state['rank'+type.toUpperCase()] = parseInt(val, 10);
            persistState();
            renderStep();
        };
        window.showRank = function(type) {
            document.querySelectorAll('.rank-panel > div[id]').forEach(el => el.classList.add('hidden'));
            document.getElementById(`rank${type.toUpperCase()}Panel`).classList.remove('hidden');
            document.querySelectorAll('.rank-tab').forEach((btn, i) => {
                btn.classList.remove('active');
                if ((i===0 && type==='mp')||(i===1&&type==='br')||(i===2&&type==='dmz')) btn.classList.add('active');
            });
        };

        function attachEvents() {}

        // × ×™×•×•×˜
        window.nextStep = function() {
            if (currentStep < stepList.length - 1) {
                currentStep++;
                persistState();
                renderStep();
            }
        };
        window.prevStep = function() {
            if (currentStep > 0) {
                currentStep--;
                persistState();
                renderStep();
            }
        };

        // ××ª×—×•×œ
        window.startApp = function() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('calcScreen').classList.remove('hidden');
            if (!loadPersisted()) {
                // reset
                state = { discounted: true, years:0, mythicWeapons:0, mythicWeaponsMax:0, legWeapons:0, epicWeapons:0, mythicChars:0, mythicCharsMax:0, legChars:0, epicChars:0, rareCharExist:false, rareCharAmount:0, level:0, rankMP:0, rankBR:0, rankDMZ:0 };
                currentStep = 0;
            }
            renderStep();
        };

        window.resetToWelcome = function() {
            localStorage.removeItem('codmState');
            document.getElementById('welcomeScreen').classList.remove('hidden');
            document.getElementById('calcScreen').classList.add('hidden');
        };

        window.showInfo = function(msg) {
            document.getElementById('modalMessage').innerText = msg;
            document.getElementById('modal').style.display = 'flex';
        };
        window.closeModal = function() {
            document.getElementById('modal').style.display = 'none';
        };
    })();
</script>
</body>
</html>